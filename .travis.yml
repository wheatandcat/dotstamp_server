language: go
go:
  - 1.8.x
sudo: required
before_install:
  - curl --silent --location https://github.com/groonga/groonga/raw/master/data/travis/setup.sh | sh
  - sudo apt-get update
  - sudo apt-get install  software-properties-common -y
  - sudo add-apt-repository ppa:mc3man/trusty-media -y
  - sudo apt-get install ffmpeg -y
  - sudo apt-get install lame -y
  - sudo apt-get install open-jtalk=1.10-1
  - sudo apt-get install open-jtalk-mecab-naist-jdic htsengine libhtsengine-dev hts-voice-nitech-jp-atr503-m001
  - sudo apt-get install sox libsox-fmt-all -y
  - mkdir tool/open-jtalk
  - mkdir tool/open-jtalk/dic
  - mkdir tool/open-jtalk/voice
  - wget http://downloads.sourceforge.net/project/mmdagent/MMDAgent_Example/MMDAgent_Example-1.6/MMDAgent_Example-1.6.zip
  - unzip MMDAgent_Example-1.6.zip
  - sudo cp -R ./MMDAgent_Example-1.6/Voice/mei /usr/share/hts-voice/
  - ls -al /usr/share/hts-voice
  - ln -s /usr/share/hts-voice/mei tool/open-jtalk/voice/mei
  - ln -s /usr/share/hts-voice/hts_voice_nitech_jp_atr503_m001-1.05/ tool/open-jtalk/voice/m100
  - ln -s /var/lib/mecab/dic/open-jtalk/naist-jdic tool/open-jtalk/dic/
  - ls -al tool/open-jtalk/voice/mei/
  - open_jtalk
  - echo 'abcd' | open_jtalk -x /home/travis/gopath/src/github.com/wheatandcat/dotstamp_server/tool/open-jtalk/dic/ -m /home/travis/gopath/src/github.com/wheatandcat/dotstamp_server/tool/open-jtalk/voice/mei/mei_normal.htsvoice -ow /home/travis/gopath/src/github.com/wheatandcat/dotstamp_server/static/files/tmp/sound/1_1.wav
addons:
  mariadb: '10.0'
install:
  - go get github.com/Masterminds/glide
  - go get github.com/golang/lint/golint
  - go get bitbucket.org/liamstask/goose/cmd/goose
before_script:
  - mysql -uroot -e "create database stamp_test"
  - mysql -uroot -e "INSTALL PLUGIN Mroonga SONAME 'ha_mroonga.so';"
  - goose -env test up
script:
  - glide install
  - go build main.go
  - go test -p 1 ./models
  - go test -p 1 -v ./tests/controllers/*
